name: Scorecard Supply-Chain Security

on:
  # Run weekly on Monday at 1:30 AM UTC
  schedule:
    - cron: '30 1 * * 1'
  # Run on every push or pull request to the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
    types: [ opened, synchronize ]

# Give the workflow permissions to write security events and use OIDC
permissions:
  security-events: write
  id-token: write

jobs:
  analysis:
    name: Scorecard analysis
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # Scorecard requires a depth of 0 (full history) for accurate scanning
          persist-credentials: false

      - name: Run OpenSSF Scorecard
        uses: ossf/scorecard-action@v2
        with:
          results_file: scorecard-results.json
          # Uploads the results to the 'Security' tab of your repo
          publish_results: true
